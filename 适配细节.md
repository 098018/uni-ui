# 适配需求
1. vue2（现有模式）
2. vue3  (非compat模式)
3. vue3  (compat模式)

其中 vue3 的两种模式，可以临时在manifest.json中配置

```
"compatConfig": {
   "MODE": 2// 2代表兼容vue2模式，3代表非兼容vue2模式
},
```

# 适配细节
## uni-grid
1. 页面 v-if 和 v-for 在同一个元素 ，vue3 更新vif优先级比vfor 更高
**错误**
```html
<uni-grid-item v-if="index < 6" v-for="(item ,index) in list" :index="index" :key="index">
	<!-- ... -->
</uni-grid-item>
```

**修改**
```html
<template v-for="(item ,index) in list">
	<uni-grid-item v-if="index < 6" :index="index" :key="index">
		<!-- ... -->
	</uni-grid-item>
</template>
```

## uni-navbar
1. 页面 slot vue3 不支持 ，改为 v-slot:xxx 且只支持 <template v-slot:xxx> 便签
**错误**
```html
<uni-nav-bar>
	<template slot="left">
		<view class="city">
			<!-- ... -->
		</view>
	</template>
</uni-nav-bar>
```

**修改**
```html
<uni-nav-bar>
	<template v-slot:left>
		<view class="city">
			<!-- ... -->
		</view>
	</template>
</uni-nav-bar>
```

2. 不支持 `tap` 事件 ，改为 `click` 
**错误**
```html
<view @tap="city">
	<!-- ... -->
</view>
```

**修改**
```html
<view @click="city">
	<!-- ... -->
</view>
```

3. vue3 bug 右插槽有问题 ，会多出来一个元素，距离没取消

## uni-number-box
1. bug input 传入 number 0  ，不显示内容  （bug不是兼容问题）
2. bug 默认值应该是 0 （bug不是兼容问题）
3. v-model 绑定 value 属性在 vue3 废弃 ，改为 modelValue ,需要做向下兼容
**错误**
```html
<view>
	<input v-model="inputValue" @input="input">
</view>
<script>
	export default {
		props:{
			value:String
		},
		data(){
			return {
				inputValue:''
			}
		},
		methods:{
			input(){
				this.inputValue = this.value + '变化'
				// 同 update:value
				this.$emit('input',this.inputValue)
			}
		}
	}
</script>
```

**修改**
```html
<view>
	<input v-model="inputValue" @input="input">
</view>
<script>
	export default {
		props:{
			// 兼容 vue2
			value:String,
			// 兼容 vue3
			modelValue:String
		},
		data(){
			return {
				inputValue:''
			}
		},
		computed:{
			// 使用计算属性获取值
			dataValue(){
				return this.modelValue || this.value
			}
		},
		methods:{
			input(){
				console.log(this.dataValue)
				this.inputValue = this.dataValue + '变化'
				// 兼容 vue2
				this.$emit('input',this.inputValue)
				// 兼容 vue3
				this.$emit('update:modelValue',this.inputValue)
			}
		}
	}
</script>
```


## uni-tag
1. bug 点击事件 切换inverted失效  （bug不是兼容问题）

## uni-transition
1. bug uni.createAnimation api 不存在

## uni-data-checkbox
1. v-model 问题 ，数据无法双向绑定 ，无法同时兼容 vue2 和 vue3

## uni-easyinput
1. vue3 bug input 的v-model暂时还有问题 ，无法兼容
2. 如果在 computed 中使用this上挂载的变量，当 computed内方法被使用且该变量未赋值 ，则会警告	
`Property "xxxx" was accessed during render but is not defined on instance. `
**错误**
```javascript
export default {
	data() {},
	computed:{
		msg(){
			if(!this.errorMessage){
				this.errorMessage = 1
			}
			return "错误：" + this.errorMessage
		}
	},
	onLoad() {},
	methods: {
		setMsg(type) {
			this.errorMessage = type
		}
	}
}
```

**修改**
```javascript
export default {
	data() {},
	computed:{
		msg(){
			return "错误：" + this.errorMessage
		}
	},
	onLoad() {
		// 需要在使用前给予出始值
		this.errorMessage = 1
	},
	methods: {
		setMsg(type) {
			this.errorMessage = type
		}
	}
}
```

## uni-forms
1. bug 在vue原型上挂载方法失效，需要提供一个方法可以兼容 vue2
2. bug 选择时间有问题
3. bug 无法校验用户名

## uni-datetime-picker
1. bug 在组间目录内使用相对路径图片 ，编译之后路径错误
## uni-data-picker 
1. v-if 和 v-for 的问题
2. bug 点击一次弹窗会关闭 ，应该是都选择完才关闭
3. vue3 compat 模式下，show-scrollbar 报警告 ,需要配置 `compatConfig:{ATTR_FALSE_VALUE: false}`
```
(deprecation ATTR_FALSE_VALUE) Attribute "show-scrollbar" with v-bind value `false` will render show-scrollbar="false" instead of removing it in Vue 3. To remove the attribute, use `null` or `undefined` instead. If the usage is intended, you can disable the compat behavior and suppress this warning with:

  configureCompat({ ATTR_FALSE_VALUE: false })
```



## uni-drawer 
1. bug vue3 不存在 this.$once
2. bug vue3 暂时发现如果报错页面会阻塞住，什么操作都不能执行
3. hook:beforeDestroy 更改为  @vnode-beforeUnmount 

## uni-rate
1. bug 选择半星，如果最后一个 ，不能选择整星

## uni-popup
1. bug 提示消息 ，如过一个没消失的时候 ，点击显示其他 ，会不能在次点击

## uni-swipe-action
1. bug wxs e.instance.getDataset() undefined

## uni-goods-nav
1. 在组件中 $emit `click` , 在页面里监听会触发原生的 `click` 事件，需要绑定 emits: ['click'],
**错误**
```html
<view>
	<view @click="onClick">点击</view>
</view>
<script>
	export default {
		props:{},
		data(){},
		methods:{
			onClick(){
				// 这样页面内绑定的事件则返回原生的 click 事件
				this.$emit('click','被点击')
			}
		}
	}
</script>
```

**修改**
```html
<view>
	<view @click="onClick">点击</view>
</view>
<script>
	export default {
		props:{},
		data(){},
		emits: ['click'],
		methods:{
			onClick(){
				this.$emit('click','被点击')
			}
		}
	}
</script>
```

## uni-card
1. vue3 非compat模式 card 页面卡死 (工程保留了 测试文件)

## uni-row && uni-col
1. 1/24 此类sass语法控制台报错,需要使用 `@use 'sass:math'; math.div(1,24)`， 无法兼容 node-sass 和 dart-sass

## uni-transition 
1. vue3 ::v-deep 需要 改为 :deep(xxxxx) ,::v-deep 已经被弃用
2. vue2 需要使用条件编译兼容 :deep()
## uni-forms
1. destroyed vue3 不支持使用 ，使用 unmounted 替换 ，vue3 非compat 模式报警告，需要使用 `条件编译解决`
2. vue3 compat 模式 modeVale 会报警告 , 配置 COMPONENT_V_MODEL: false 后会 走 vue3 编译 ，vue2 兼容会出问题

```javascript
export default {
	// 使用 compatConfig ，不能使用 提示的 configureCompat
	compatConfig: { COMPONENT_V_MODEL: false }
}	
```
3. bug vue3 compat 模式 报 `selectable` 警告 ，text 标签的问题

  