# 差异
## v-if 与 v-for 的优先级的差异
在 vue3 中 v-if 和 v-for 在同一个元素 ，v-if优先级比v-for更高,所以不能在同一元素出现。

**修改前**
```html
<view v-if="index < 6" v-for="(item ,index) in list" :key="index">
	<!-- ... -->
</view>
```

**修改后**

由于语法上存在歧义，建议避免在同一元素上同时使用两者。

比起在模板层面管理相关逻辑，更好的办法是通过创建计算属性筛选出列表，并以此创建可见元素。

```html
<template v-for="(item ,index) in dataLists">
	<view :key="index">
		<!-- ... -->
	</view>
</template>
<script>
	export default {
		data(){
			return {
				lists:[
					// ...
				]
			}
		},
		computed:{
			// 使用计算属性获取值
			dataLists(){
				return this.lists.filter(item=> index < 6)
			}
		}
	}
</script>
```

## slot 插槽差异
`slot="xxx"` 的用法在 vue3 中已经弃用，请使用 `v-slot:xxx` 用法， 且只支持在 <template v-slot:xxx> 标签上使用

**修改前**
```html
<uni-nav-bar>
	<view slot="left" class="city">
		<!-- ... -->
	</view>
</uni-nav-bar>
```

**修改后**
```html
<uni-nav-bar>
	<template v-slot:left>
		<view class="city">
			<!-- ... -->
		</view>
	</template>
</uni-nav-bar>
```

## 事件差异
1. 在组件中 $emit `click` , 在页面里监听会触发原生的 `click` 事件，需要绑定 emits: ['click']

**修改前**
```html
<view>
	<view @click="onClick">点击</view>
</view>
<script>
	export default {
		methods:{
			onClick(){
				// 这样页面内绑定的事件则返回原生的 click 事件
				this.$emit('click','被点击')
			}
		}
	}
</script>
```

**修改后**
```html
<view>
	<view @click="onClick">点击</view>
</view>
<script>
	export default {
		// 需要使用 emits 指定事件名称
		emits: ['click'],
		methods:{
			onClick(){
				this.$emit('click','被点击')
			}
		}
	}
</script>
```

2. vue3 实例中完全移除了 $on、$off 和 $once 方法。$emit 仍然包含于现有的 API 中，因为它用于触发由父组件声明式添加的事件处理函数。

3. VNode Lifecycle Events（breaking）

**修改前**
```html
 <child-component @hook:updated="onUpdated">
```

**修改后**
```html
<template>
  <child-component @vnode-updated="onUpdated">
</template>
<!-- 或者 -->
<template>
  <child-component @vnodeUpdated="onUpdated">
</template>
```

## v-model 的差异
1. v-model 绑定props value 属性修改为 modelValue ,需要做向下兼容处理 

**修改前**
```html
<view>
	绑定的数据：{{inputValue}}
	<button @click="onClick">数据双向绑定</button>	
</view>
<script>
	export default {
		// vue2 接受 value
		props:{
			value:String
		},
		data(){
			return {
				inputValue:''
			}
		},
		methods:{
			onClick(){
				this.inputValue = this.value + '变化'
				// 同 update:value ,通过 inpup 进行数据双向绑定
				this.$emit('input',this.inputValue)
			}
		}
	}
</script>
```

**修改后**
```html
<view>
	绑定的数据：{{inputValue}}
	<button @click="onClick">数据双向绑定</button>	
</view>
<script>
	export default {
		props:{
			// 兼容 vue2
			value:String,
			// 兼容 vue3 ，vue3 默认接受props 不在是 value ,而是 modelValue
			modelValue:String
		},
		data(){
			return {
				inputValue:''
			}
		},
		computed:{
			// 使用计算属性获取值
			dataValue(){
				return this.modelValue || this.value
			}
		},
		methods:{
			input(){
				this.inputValue = this.dataValue + '变化'
				// 兼容 vue2
				this.$emit('input',this.inputValue)
				// 兼容 vue3
				this.$emit('update:modelValue',this.inputValue)
			}
		}
	}
</script>
```

2. vue3 compat 模式 modeVale 会报警告 , 取消警告需要配置 COMPONENT_V_MODEL: false ， 且 vue3 非compat模式 和 vue3 compat模式 无法完全兼容 ，需要使用条件编译处理

```javascript
export default {
	compatConfig: { COMPONENT_V_MODEL: false }
}	
```

## sass 用法差异
1. vue3 ::v-deep 或 /deep/ 需要 改为 :deep(xxxxx) ,::v-deep 已经被弃用，且 vue2 和 vue3 无法完全兼容 ，需要使用条件编译处理

**修改前**
```css
.a ::v-deep .b {}
```

**修改后**
```css
.a :deep(.b) {}
```

2. 运算如：`1/24` 此类用法不支持直接使用 ，需要使用 `math.div(1,24)` ，使用前需在`<style>`顶部引入 `@use 'sass:math';` ,且 vue2 和 vue3 无法完全兼容 ，需要使用条件编译处理

## 生命周期差异
1. `destroyed` vue3 不支持使用 ，使用 `unmounted` 替换 ，且 vue3 非compat模式 和 vue3 compat模式无法完全兼容 ，需要使用条件编译处理

2. `beforeDestroy` vue3 不支持使用 ，使用 `beforeUnmount` 替换 ，且 vue3 非compat模式 和 vue3 compat模式无法完全兼容 ，需要使用条件编译处理

# bug

## uni-ui bug
- uni-navbar 右插槽在 vue3 异常，vue2 正常
- uni-number-box 默认值应该是 0 而不是1
- uni-tag vue3 动态更改 inverted 属性无效
- uni-datetime-picker vue3 时间戳选择错误
- uni-forms vue2 无法动态检验用户名
- uni-data-picker 点击一次弹窗会关闭 ，应该是都选择完才关闭
- uni-rate 半星模式 ，不能选择整星
- uni-popup-message 定时器出现了问题 ，需要详测

## 框架 bug
- vue3 input v-model 绑定数据为 number 0 ，内容不显示
- uni-forms 在 vue2 上挂载的  Vue.prototype.binddata = function()=>{} 在 vue3 不生效 ，需要提供解决方案   
-    
- vue3 组件使用相对路径引用非 static 下的图片 ，编译后路径不正确 `./abc.png` 编译为 `/abc.png`
- vue3 非 compat 模式下，show-scrollbar 报警告 `(deprecation ATTR_FALSE_VALUE) Attribute "show-scrollbar" with v-bind value 'false' will render show-scrollbar="false" instead of removing it in Vue 3. To remove the attribute, use 'null' or 'undefined' instead. If the usage is intended, you can disable the compat behavior and suppress this warning with:` 
- vue3 非 compat 模式下，destroyed 报警告 ` (deprecation OPTIONS_DESTROYED) 'destroyed' has been renamed to 'unmounted'.` 
- vue3 compat 模式 报 `selectable` 警告
- vue3 wxs e.instance.getDataset() undefined

## 其他 
- uni-drawer vue3 如果this.$once 报错 ,会导致整个页面卡住 （详见测试页面）
- uni-card vue3 不确定是那些写法导致整个项目卡住 ，无法加载成功 （详见测试页面）
- vue3 非兼容模式  使用 model:{} 方法， modelValue 不触发 watch